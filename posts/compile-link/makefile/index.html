<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Makefile - </title><meta name=author content><meta name=author-link content><meta name=description content="variables1
  
    
  
It should be noted that the usage of site a variable in makefile is different from using it in shell."><meta itemprop=name content="Makefile"><meta itemprop=description content="variables1 It should be noted that the usage of site a variable in makefile is different from using it in shell."><meta itemprop=datePublished content="2023-09-16T17:49:00+08:00"><meta itemprop=dateModified content="2024-08-01T23:09:58+08:00"><meta itemprop=wordCount content="1257"><meta itemprop=keywords content="Compile-Link"><meta property="og:url" content="https://gaohongy.github.io/blog/posts/compile-link/makefile/"><meta property="og:title" content="Makefile"><meta property="og:description" content="variables1 It should be noted that the usage of site a variable in makefile is different from using it in shell."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-16T17:49:00+08:00"><meta property="article:modified_time" content="2024-08-01T23:09:58+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Makefile"><meta name=twitter:description content="variables1 It should be noted that the usage of site a variable in makefile is different from using it in shell."><meta name=application-name content="FixIt"><meta name=apple-mobile-web-app-title content="FixIt"><meta name=theme-color data-light=#f8f8f8 data-dark=#252627 content="#f8f8f8"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://gaohongy.github.io/blog/posts/compile-link/makefile/><link rel=prev href=https://gaohongy.github.io/blog/posts/c-c++/c++-asynchronous-and-synchronous-mechanisms/><link rel=next href=https://gaohongy.github.io/blog/posts/linux/variables-in-linux/><link rel=stylesheet href=/blog/css/style.min.css><link rel=preload href=/blog/lib/fontawesome-free/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/blog/lib/animate/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Makefile","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/gaohongy.github.io\/blog\/posts\/compile-link\/makefile\/"},"genre":"posts","wordcount":1257,"url":"https:\/\/gaohongy.github.io\/blog\/posts\/compile-link\/makefile\/","datePublished":"2023-09-16T17:49:00+08:00","dateModified":"2024-08-01T23:09:58+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Author"},"description":""}</script></head><body data-header-desktop=sticky data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=wide><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/blog/ title><img loading=lazy src=https://img2024.cnblogs.com/blog/1898659/202406/1898659-20240630192930755-1492568318.png alt=https://img2024.cnblogs.com/blog/1898659/202406/1898659-20240630192930755-1492568318.png data-title=https://img2024.cnblogs.com/blog/1898659/202406/1898659-20240630192930755-1492568318.png width=26 height=26 class=logo style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/blog/posts/>Post</a></li><li class=menu-item><a class=menu-link href=/blog/categories/>Category</a></li><li class=menu-item><a class=menu-link href=/blog/tags/>Tag</a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/blog/ title><img loading=lazy src=https://img2024.cnblogs.com/blog/1898659/202406/1898659-20240630192930755-1492568318.png alt=https://img2024.cnblogs.com/blog/1898659/202406/1898659-20240630192930755-1492568318.png data-title=https://img2024.cnblogs.com/blog/1898659/202406/1898659-20240630192930755-1492568318.png width=26 height=26 class=logo style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'><span class=header-title-text></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></li><li class=menu-item><a class=menu-link href=/blog/posts/>Post</a></li><li class=menu-item><a class=menu-link href=/blog/categories/>Category</a></li><li class=menu-item><a class=menu-link href=/blog/tags/>Tag</a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Switch Theme"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class="aside-collection animate__animated animate__fadeIn animate__faster" aria-label=Collections></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Makefile</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Anonymous</span></span><span class=post-included-in>&nbsp;included in <a href=/blog/categories/compile-link/ class=post-category title="Category - Compile-Link"><i class="fa-regular fa-folder fa-fw" aria-hidden=true></i> Compile-Link</a></span></div><div class=post-meta-line><span title="published on 2023-09-16 17:49:00"><i class="fa-solid fa-calendar-days fa-fw me-1" aria-hidden=true></i><time datetime=2023-09-16>2023-09-16</time></span>&nbsp;<span title="Updated on 2024-08-01 23:09:58"><i class="fa-regular fa-calendar-check fa-fw me-1" aria-hidden=true></i><time datetime=2024-08-01>2024-08-01</time></span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#variablesvariable>variables</a></li><li><a href=#wildcard>Wildcard</a></li><li><a href=#automatically-generate-dependencies>Automatically generate dependencies</a></li><li><a href=#hide-commands-themself>Hide commands themself</a></li><li><a href=#function>Function</a></li><li><a href=#automation-variables>Automation variables</a></li><li><a href=#example>Example</a></li><li><a href=#pattern-specific-variable-values>Pattern-specific Variable Values</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></div><div class=content id=content data-end-flag=EOF><h2 id=variablesvariable class=heading-element><span>variables<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></span>
<a href=#variablesvariable class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>It should be noted that the usage of site a variable in makefile is different from using it in shell.</p><p>In makefile, we use <code>$()</code> to site a variable, which is means that command substitution in shll<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><p>There are three ways to assign for a variable:</p><ol><li><code>=</code>: It allows that the subsquent variable uses the following variable.</li><li><code>:=</code>: It is same with the assignment symbol in programming language.</li><li><code>?=</code>: If the varible has value, it will do nothing.</li></ol><h2 id=wildcard class=heading-element><span>Wildcard</span>
<a href=#wildcard class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>The wildcard in makefile is similar with macro in C/C++, it isn&rsquo;t similar with wildcard in linux shell, so it doesn&rsquo;t expend automatically.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>object1 = *.c  // *.c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>object2 = $(wildcard *.cpp) // main.cpp t1.cpp t2.cpp</span></span></code></pre></td></tr></table></div></div><h2 id=automatically-generate-dependencies class=heading-element><span>Automatically generate dependencies</span>
<a href=#automatically-generate-dependencies class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Utilizing the <code>-M</code> and <code>-MM</code> options to get the dependencies of source code from gcc/g++.</p><blockquote><p>These options&rsquo; document can be found at <a href=https://gcc.gnu.org/onlinedocs/gcc-12.3.0/gcc/Preprocessor-Options.html target=_blank rel="external nofollow noopener noreferrer">Preprocessor-Options</a>. (About why these option in the preprocessor options, it is easy to understand. In the state of preprocessor, the preprocessor will judge the header file, so it knows which files are dependented by current file.)</p></blockquote><h2 id=hide-commands-themself class=heading-element><span>Hide commands themself</span>
<a href=#hide-commands-themself class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>Place <code>@</code> front of the command, e.g.
If you use <code>echo "compiling..."</code> in makefile, you will get the output</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#34;compiling...&#34;
</span></span><span class=line><span class=cl>compiling...</span></span></code></pre></td></tr></table></div></div><p>If you use <code>@echo "compiling..."</code>, you will get the output</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>compiling...</span></span></code></pre></td></tr></table></div></div><h2 id=function class=heading-element><span>Function</span>
<a href=#function class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p><a class=lightgallery href="https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png?size=large" data-thumbnail="https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png?size=small" data-sub-html="<h2>https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png</h2>"><img loading=lazy src=https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png alt=https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png srcset="https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png?size=small, https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png?size=medium 1.5x, https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png?size=large 2x" data-title=https://cdn.jsdelivr.net/gh/gaohongy/cloudImages@master/202309171043153.png style="background:url(/blog/images/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title;for(const e of["style","data-title","onerror","onload"])this.removeAttribute(e)'></a></p><h2 id=automation-variables class=heading-element><span>Automation variables</span>
<a href=#automation-variables class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><ul><li><code>$@</code> : 匹配目标中模式定义的集合</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-makefile data-lang=makefile><span class=line><span class=cl><span class=nf>%.o</span><span class=o>:</span> %.<span class=n>c</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>CC<span class=k>)</span> <span class=k>$(</span>CFLAGS<span class=k>)</span> $&lt; -o <span class=nv>$@</span>
</span></span></code></pre></td></tr></table></div></div><p>上述的 <code>$@</code> 指代的即为 <code>%.o</code>。不过从上述示例中，并不能看出“集合”这一含义，可以结合 <code>$%</code> 来看。</p><ul><li><code>$%</code> : 仅当目标是函数库文件时，表示规则中的目标成员名</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-makefile data-lang=makefile><span class=line><span class=cl><span class=nf>fun(a b c)</span><span class=o>:</span> 
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> $% <span class=nv>$@</span>
</span></span></code></pre></td></tr></table></div></div><p><code>$%</code> 将代表 <code>a</code>，<code>$@</code> 将代表 <code>fun</code>。从这个示例中就可以看出 <code>$@</code> “集合“这一含义了。</p><p>不过 <code>$%</code> 的定义中提到“仅当目标是函数库文件“，如何理解这一点？</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-makefile data-lang=makefile><span class=line><span class=cl><span class=nf>fun</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> $%
</span></span></code></pre></td></tr></table></div></div><p>此时 <code>$%</code> 为空，由此即可理解这一变量的用法。</p><ul><li><code>$&lt;</code> : 第一个依赖文件的名字</li></ul><p>例如，在 main.o: main.c defs.h 中，$&lt; 就是 main.c。</p><ul><li><code>$?</code> : 所有比目标新的依赖目标的集合</li></ul><p>例如，如果 main.o 依赖于 main.c 和 defs.h，而 defs.h 比 main.o 更新，那么 $? 就是 defs.h。</p><ul><li><code>$^</code> : 所有的依赖目标的集合</li></ul><p>例如，在 main.o: main.c defs.h 中，$^ 就是 main.c defs.h</p><ul><li><code>$+</code> : 这个变量很像 $^ ，也是所有依赖目标的集合。只是它不去除重复的依赖目标</li></ul><p>例如，在 main.o: main.c defs.h main.c 中，$+ 就是 main.c defs.h main.c</p><h2 id=example class=heading-element><span>Example</span>
<a href=#example class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><details><summary>Advanced makefile usage example code</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 编译工具信息
</span></span><span class=line><span class=cl>CXX = g++
</span></span><span class=line><span class=cl>CFLAGS = -std=c++11 -Wall
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 目录信息
</span></span><span class=line><span class=cl>SRC_DIR = src
</span></span><span class=line><span class=cl>BUILD_DIR = build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 源文件列表
</span></span><span class=line><span class=cl>SRCS = $(wildcard $(SRC_DIR)/*.cpp)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 生成目标文件列表(目标文件.o和源文件.cpp一一对应)
</span></span><span class=line><span class=cl>OBJS = $(patsubst $(SRC_DIR)/%.cpp,$(BUILD_DIR)/%.o,$(SRCS))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 最终目标文件
</span></span><span class=line><span class=cl>TARGET = $(BUILD_DIR)/main
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.PHONY: all clean
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>all: $(TARGET)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$(TARGET): $(OBJS)
</span></span><span class=line><span class=cl>	@mkdir -p $(dir $@) # $(dir $@) = $(BUILD_DIR)
</span></span><span class=line><span class=cl>	@$(CXX) $(CFLAGS) $^ -o $@
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$(BUILD_DIR)/%.o: $(SRC_DIR)/%.cpp
</span></span><span class=line><span class=cl>	@mkdir -p $(dir $@)
</span></span><span class=line><span class=cl>	@$(CXX) $(CFLAGS) -c $&lt; -o $@
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>clean:
</span></span><span class=line><span class=cl>	rm -rf $(BUILD_DIR)</span></span></code></pre></td></tr></table></div></div></details><p>The above makefile can judge the source code which locates in src directory, and output the object file into the build directory. The following image shows the project file structure.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>% tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Makefile
</span></span><span class=line><span class=cl>└── src
</span></span><span class=line><span class=cl>    ├── funcs.cpp
</span></span><span class=line><span class=cl>    └── main.cpp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2 directories, 3 files</span></span></code></pre></td></tr></table></div></div><p>After compiling, we will get the following file structure.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>% tree
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── Makefile
</span></span><span class=line><span class=cl>├── build
</span></span><span class=line><span class=cl>│   ├── funcs.o
</span></span><span class=line><span class=cl>│   ├── main
</span></span><span class=line><span class=cl>│   └── main.o
</span></span><span class=line><span class=cl>└── src
</span></span><span class=line><span class=cl>    ├── funcs.cpp
</span></span><span class=line><span class=cl>    └── main.cpp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>3 directories, 6 files</span></span></code></pre></td></tr></table></div></div><p>There are some noteworthy points.</p><ol><li><code>$^</code> and <code>$&lt;</code>
Using the same file structure and editing the makefile, we can understand the difference between these two automation variables.</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 编译工具信息
</span></span><span class=line><span class=cl>CXX = g++
</span></span><span class=line><span class=cl>CFLAGS = -std=c++11 -Wall
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 目录信息
</span></span><span class=line><span class=cl>SRC_DIR = src
</span></span><span class=line><span class=cl>BUILD_DIR = build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 源文件列表
</span></span><span class=line><span class=cl>SRCS = $(wildcard $(SRC_DIR)/*.cpp)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 生成目标文件列表(目标文件.o和源文件.cpp一一对应)
</span></span><span class=line><span class=cl>OBJS = $(patsubst $(SRC_DIR)/%.cpp,$(BUILD_DIR)/%.o,$(SRCS))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 最终目标文件
</span></span><span class=line><span class=cl>TARGET = $(BUILD_DIR)/main
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.PHONY: all clean
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>all: $(TARGET)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$(TARGET): $(OBJS)
</span></span><span class=line><span class=cl>	@echo &#34;\n&#34;
</span></span><span class=line><span class=cl>	@echo $^
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$(BUILD_DIR)/%.o: $(SRC_DIR)/%.cpp
</span></span><span class=line><span class=cl>	@ echo $&lt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>clean:
</span></span><span class=line><span class=cl>	rm -rf $(BUILD_DIR)</span></span></code></pre></td></tr></table></div></div><p>After we excute the <code>make</code> command, we will get the result.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>src/funcs.cpp
</span></span><span class=line><span class=cl>src/main.cpp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>build/funcs.o build/main.o</span></span></code></pre></td></tr></table></div></div><p>Based on the project file structure, we can understand the difference between them.</p><h2 id=pattern-specific-variable-values class=heading-element><span>Pattern-specific Variable Values</span>
<a href=#pattern-specific-variable-values class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><p>The most obvious and easy example is distinguishing the difference between <code>$&lt;</code> and <code>$^</code> in Automation variables.
i.e. the difference between <code>$(BUILD_DIR)/%.o: $(SRC_DIR)/%.cpp</code> and <code>$(OBJS): $(SRCS)</code></p><p>Although we know the <code>$&lt;</code> is the name of the first prerequisite and <code>$^</code> is the names of all the prerequisites, if we don&rsquo;t know the difference of the above expression of <code>target: prerequisites</code>, we can&rsquo;t understand the result of the <code>g++ $(CFLAGS) -c $&lt; -o $@</code>.</p><p>In short, if we still use the above file structure, when using <code>$(OBJS): $(SRCS)</code>, the <code>$(OBJS)</code> is the <code>build/funcs.o build/main.o</code>, they are one expression, but using
<code>$(BUILD_DIR)/%.o: $(SRC_DIR)/%.cpp</code>, the <code>$(BUILD_DIR)/%.o</code> is <code>build/funcs.o</code> and <code>build/main.o</code>, they are two expressions, it looks like a enumation, so we can use this to generate the corresponding .o object file and .c source file.</p><h2 id=reference class=heading-element><span>Reference</span>
<a href=#reference class=heading-mark><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5.0 114.95 4.95l-2.5 2.5a3.5 3.5.0 01-4.95.0.751.751.0 01.018-1.042.751.751.0 011.042-.018 1.998 1.998.0 002.83.0l2.5-2.5a2.002 2.002.0 00-2.83-2.83l-1.25 1.25a.751.751.0 01-1.042-.018.751.751.0 01-.018-1.042zm-4.69 9.64a1.998 1.998.0 002.83.0l1.25-1.25a.751.751.0 011.042.018.751.751.0 01.018 1.042l-1.25 1.25a3.5 3.5.0 11-4.95-4.95l2.5-2.5a3.5 3.5.0 014.95.0.751.751.0 01-.018 1.042.751.751.0 01-1.042.018 1.998 1.998.0 00-2.83.0l-2.5 2.5a1.998 1.998.0 000 2.83z"/></svg></a></h2><blockquote><ul><li>[1] <a href=https://www.gnu.org/software/make/manual/ target=_blank rel="external nofollow noopener noreferrer">GNU Make Manual</a></li><li>[2] <a href=https://superuser.com/questions/360178/what-does-make-install-do target=_blank rel="external nofollow noopener noreferrer">What does &lsquo;make install&rsquo; do?</a></li></ul></blockquote><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://seisman.github.io/how-to-write-makefile/variables.html target=_blank rel="external nofollow noopener noreferrer">使用变量 | 跟我一起写Makefile</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://gaohongy.github.io/blog/posts/linux/linux-basic-knowledge/#%E5%91%BD%E4%BB%A4%E6%9B%BF%E6%8D%A2--%E6%88%96- target=_blank rel="external nofollow noopener noreferrer">命令替换</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Updated on 2024-08-01 23:09:58">Updated on 2024-08-01&nbsp;</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/blog/>Home</a></span></section></div><div class=post-nav><a href=/blog/posts/c-c++/c++-asynchronous-and-synchronous-mechanisms/ class=post-nav-item rel=prev title="C++ Asynchronous and Synchronous Mechanisms"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>C++ Asynchronous and Synchronous Mechanisms</a>
<a href=/blog/posts/linux/variables-in-linux/ class=post-nav-item rel=next title="Variables in Linux">Variables in Linux<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article><aside class=toc id=toc-auto aria-label=Contents><h2 class=toc-title>Contents&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class="toc-content always-active" id=toc-content-auto></div></aside></main></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Back to Top"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class=variant-numeric>0%</span></div></div><div id=mask></div><div class=reading-progress-bar style=left:0;top:0></div><noscript><div class=noscript-warning>This website works best with JavaScript enabled.</div></noscript></div><link rel=stylesheet href=/blog/lib/lightgallery/css/lightgallery-bundle.min.css><link rel=preload href=/blog/lib/katex/katex.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=/blog/lib/katex/katex.min.css></noscript><link rel=stylesheet href=/blog/lib/cookieconsent/cookieconsent.min.css><script src=/blog/lib/autocomplete/autocomplete.min.js defer></script><script src=/blog/lib/fuse/fuse.min.js defer></script><script src=/blog/lib/twemoji/twemoji.min.js defer></script><script src=/blog/lib/lightgallery/lightgallery.min.js defer></script><script src=/blog/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js defer></script><script src=/blog/lib/lightgallery/plugins/zoom/lg-zoom.min.js defer></script><script src=/blog/lib/katex/katex.min.js defer></script><script src=/blog/lib/katex/auto-render.min.js defer></script><script src=/blog/lib/katex/copy-tex.min.js defer></script><script src=/blog/lib/katex/mhchem.min.js defer></script><script src=/blog/lib/cookieconsent/cookieconsent.min.js defer></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{enable:!1},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/blog/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:20,minMatchCharLength:2,noResultsFound:"No results found",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0,version:"v0.3.9"}</script><script src=/blog/js/theme.min.js defer></script></body></html>